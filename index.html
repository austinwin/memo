<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <title>Journal</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#f2f2f7" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="app-header">
    <div class="header-content">
      <div class="header-title">
        <h1>Journal</h1>
        <p class="header-subtitle">Your daily reflections</p>
      </div>
      <div class="header-actions">
        <input id="importInput" type="file" accept="application/json" hidden />
        <button id="importBtn" class="btn header-icon-btn" type="button" title="Import">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        </button>
        <button id="exportBtn" class="btn header-icon-btn" type="button" title="Export">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        </button>
      </div>
    </div>
  </header>

  <main class="app-main">
    <section class="memo-form-section" id="composeSection">
      <header class="memo-form-header">
        <button type="button" class="form-close-btn" id="formCloseBtn">Cancel</button>
        <div>
          <h2>New Entry</h2>
          <p id="todayLabel" class="today-label"></p>
        </div>
        <button id="todayShortcutBtn" class="form-close-btn" type="button">Now</button>
      </header>
      <form id="memoForm" class="memo-form">
        <div class="form-row">
          <label>
            Title
            <input type="text" id="title" name="title" required maxlength="100" placeholder="What's on your mind?" />
          </label>
          <label>
            Date &amp; Time
            <input type="datetime-local" id="datetime" name="datetime" />
          </label>
        </div>
        <label>
          Entry
          <textarea id="text" name="text" rows="5" required placeholder="Write about your day, thoughts, or anything you want to remember..."></textarea>
        </label>
        <div class="todo-toggle">
          <span class="todo-toggle-label">Track as Task</span>
          <span class="todo-toggle-help">Treat this memo as a to-do you want to track.</span>
          <div class="todo-toggle-control">
            <input type="checkbox" id="isTodo" name="isTodo" />
            <span>Track as task</span>
          </div>
        </div>
        <div class="form-location-row">
          <button type="button" id="locationBtn" class="btn secondary">ğŸ“ Add Location</button>
          <p id="locationSummary" class="location-summary" hidden></p>
        </div>
        <div class="form-mood-row">
          <div class="mood-picker" aria-label="How are you feeling?">
            <button type="button" class="mood-btn" data-mood="great" title="Great">ğŸ˜Š</button>
            <button type="button" class="mood-btn" data-mood="ok" title="Okay">ğŸ˜</button>
            <button type="button" class="mood-btn" data-mood="bad" title="Not great">ğŸ˜</button>
          </div>
          <div class="form-actions">
            <button type="reset" class="btn">Clear</button>
            <button type="submit" class="btn primary">Save Entry</button>
          </div>
        </div>
      </form>
    </section>

    <section class="memo-list-section">
      <div class="memo-list-header">
        <div class="memo-list-title">
          <h2>Your Entries</h2>
          <p class="memo-list-subtitle">A calm space for your memories</p>
          <p class="memo-last-entry" id="lastEntryLabel">None yet</p>
        </div>
      </div>
      <div class="memo-list-controls">
        <div class="memo-controls-row primary-controls">
          <input
            id="searchInput"
            class="search-input"
            type="search"
            placeholder="Search entries..."
            aria-label="Search entries"
          />
        </div>
        <div class="memo-controls-row secondary-controls">
          <select id="viewSelect" class="filter-select" aria-label="Filter entries">
            <option value="all">All Entries</option>
            <option value="today">Today</option>
            <option value="pinned">Pinned</option>
            <option value="tasks">Tasks</option>
            <option value="map">Map View</option>
          </select>
          <select id="moodSelect" class="filter-select" aria-label="Filter by mood">
            <option value="all">Mood: All</option>
            <option value="great">Mood: ğŸ˜Š</option>
            <option value="ok">Mood: ğŸ˜</option>
            <option value="bad">Mood: ğŸ˜</option>
          </select>
          <select id="sortSelect" class="filter-select" aria-label="Sort entries">
            <option value="newest">Newest</option>
            <option value="oldest">Oldest</option>
            <option value="title">A-Z</option>
          </select>
        </div>
      </div>
      <section class="memo-stats" aria-label="Writing statistics">
        <div class="stat-chip">
          <span class="stat-icon">ğŸ”¥</span>
          <span id="streakCount">0</span>
        </div>
        <div class="stat-chip">
          <span class="stat-icon">ğŸ“…</span>
          <span id="weekCount">0</span>
          <span class="stat-label-short">wk</span>
        </div>
        <div class="stat-chip">
          <span class="stat-icon">ğŸ“</span>
          <span id="todayWords">0</span>
          <span class="stat-label-short">words</span>
        </div>
        <div class="stat-chip">
          <span class="stat-icon">ğŸ“Š</span>
          <span id="weekWords">0</span>
          <span class="stat-label-short">total</span>
        </div>
        <button id="dailyGoalChip" class="stat-chip stat-chip-button" type="button">
          <span class="stat-icon">ğŸ¯</span>
          <span id="dailyGoalLabel">No goal</span>
        </button>
      </section>
      <div id="memoList" class="memo-list"></div>
      
      <div id="paginationControls" class="pagination-controls" hidden>
        <button id="prevPageBtn" class="pagination-btn" type="button" disabled aria-label="Previous page">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
        </button>
        <span id="pageIndicator" class="pagination-indicator">1 / 1</span>
        <button id="nextPageBtn" class="pagination-btn" type="button" aria-label="Next page">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
        </button>
      </div>
    </section>

    <section class="memo-detail-section" id="memoDetailSection" hidden>
      <!-- This will be populated by JS -->
    </section>
  </main>

  <div id="mapShell" class="map-shell" hidden>
    <div id="mapView" class="map-view"></div>
    <div id="mapOverlay" class="map-overlay">
      <div class="map-floating-header">
        <div class="map-header-row">
          <button id="mapCloseBtn" class="btn icon-btn blur-btn" type="button" aria-label="Back">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
          </button>
          <input id="mapSearchInput" class="map-search-input" type="search" placeholder="Search..." aria-label="Search map entries" />
          <button id="mapRecenterBtn" class="btn icon-btn blur-btn" type="button" aria-label="Recenter">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 21h5v-5"/></svg>
          </button>
        </div>
        <div class="map-header-row secondary-row">
          <span id="mapCountLabel" class="map-count-badge">0 places</span>
          <select id="mapMoodSelect" class="map-marker-select glass-select" aria-label="Filter map by mood">
            <option value="all">All moods</option>
            <option value="great">ğŸ˜Š Great</option>
            <option value="ok">ğŸ˜ Okay</option>
            <option value="bad">ğŸ˜ Bad</option>
          </select>
          <select id="mapMarkerSelect" class="map-marker-select glass-select" aria-label="Map symbol style">
            <option value="pin">ğŸ“</option>
            <option value="dot">ğŸ”´</option>
            <option value="emoji">ğŸ˜Š</option>
          </select>
          <button id="mapTimelineToggleBtn" class="btn icon-btn blur-btn map-small-toggle" type="button" aria-pressed="false" aria-label="Toggle mood timeline">
            â±
          </button>
          <button id="mapHeatToggleBtn" class="btn icon-btn blur-btn map-small-toggle" type="button" aria-pressed="false" aria-label="Toggle density heatmap">
            ğŸ”¥
          </button>
        </div>
        <div id="mapTimelineBar" class="map-timeline-bar" hidden>
          <div class="map-timeline-row">
            <input id="mapTimelineSlider" class="map-timeline-slider" type="range" min="0" max="100" value="100" aria-label="Filter by time" />
          </div>
          <div class="map-timeline-info-row">
            <span id="mapTimelineLabel" class="map-timeline-label">All time</span>
            <select id="mapTimelineMode" class="map-timeline-mode" aria-label="Timeline mode">
              <option value="cumulative">Up to</option>
              <option value="daily">Daily</option>
              <option value="weekly">Weekly</option>
              <option value="monthly">Monthly</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>

  <button class="compose-fab" id="composeFab" type="button" aria-label="New entry">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
  </button>

  <nav class="bottom-nav" id="bottomNav">
    <button class="nav-item active" data-nav="entries" type="button">
      <svg class="nav-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
      <span>Entries</span>
    </button>
    <button class="nav-item" data-nav="map" type="button">
      <svg class="nav-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"/><line x1="8" y1="2" x2="8" y2="18"/><line x1="16" y1="6" x2="16" y2="22"/></svg>
      <span>Map</span>
    </button>
  </nav>

  <div id="locationModal" class="modal" hidden>
    <div class="modal-content">
      <header class="modal-header">
        <h3>Add Location</h3>
        <button type="button" id="locationModalClose" class="icon-btn">âœ•</button>
      </header>
      <div class="modal-body">
        <div id="locationMap" class="location-map"></div>
        <div class="location-controls">
          <button type="button" id="useCurrentLocationBtn" class="btn secondary">ğŸ“ Use Current Location</button>
          <div class="location-label-group">
            <input type="text" id="locationLabelInput" class="location-label-input" placeholder="Label (Home, Office, Cafe...)" />
            <select id="locationSymbolInput" class="location-symbol-select" aria-label="Location Symbol">
              <option value="ğŸ“" selected>ğŸ“ Pin</option>
              <option value="ğŸ ">ğŸ  Home</option>
              <option value="ğŸ¢">ğŸ¢ Office</option>
              <option value="â˜•ï¸">â˜•ï¸ Cafe</option>
              <option value="ğŸ½ï¸">ğŸ½ï¸ Restaurant</option>
              <option value="ğŸ›’">ğŸ›’ Store</option>
              <option value="â¤ï¸">â¤ï¸ Heart</option>
              <option value="â­">â­ Star</option>
              <option value="âœˆï¸">âœˆï¸ Travel</option>
              <option value="ğŸŒ²">ğŸŒ² Nature</option>
            </select>
          </div>
        </div>
      </div>
      <footer class="modal-footer">
        <button type="button" id="locationClearBtn" class="btn">Remove</button>
        <button type="button" id="locationSaveBtn" class="btn primary">Save Location</button>
      </footer>
    </div>
  </div>

  <template id="memoTemplate">
    <article class="memo-card">
      <header class="memo-card-header">
        <div class="memo-title-group">
          <div class="memo-todo">
            <input type="checkbox" class="memo-todo-checkbox" aria-label="Mark task as done" />
          </div>
          <div>
            <h3 class="memo-title"></h3>
            <p class="memo-datetime"></p>
          </div>
        </div>
        <div class="memo-card-actions">
          <span class="memo-mood" aria-hidden="true"></span>
          <button class="icon-btn pin-btn" title="Pin or unpin">ğŸ“Œ</button>
          <button class="icon-btn edit-btn" title="Edit">âœï¸</button>
          <button class="icon-btn delete-btn" title="Delete">ğŸ—‘ï¸</button>
        </div>
      </header>
      <p class="memo-text"></p>
    </article>
  </template>

  <div id="toast" class="toast" hidden></div>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script type="module" src="src/main.js"></script>
</body>
</html>
